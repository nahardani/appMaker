<!DOCTYPE html>
<html lang="fa" dir="rtl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پروژه‌ها</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css"/>
</head>
<body>

<!-- هدر (در صورت داشتن فرگمنت مشترک) -->
<th:block th:replace="fragments/_header :: topbar(
        title='فهرست / ایجاد پروژه',
        project=${null})"></th:block>

<div class="container">

    <!-- فهرست پروژه‌ها (بالا) -->
    <div class="card">
        <div class="card-head"><h3>فهرست پروژه‌ها</h3></div>

        <table class="table">
            <thead>
            <tr>
                <th style="text-align:right;">نام پروژه</th>
                <th style="text-align:right;">نام شرکت</th>
                <th style="text-align:right;">نسخهٔ جاوا</th>
                <th style="text-align:right;">تاریخ ایجاد</th>
                <th style="width:1%"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p : ${projects}">
                <td th:text="${p.projectName}">project</td>
                <td th:text="${p.companyName}">company</td>
                <td th:text="${p.javaVersion}">17</td>
                <td th:text="${#dates.format(p.createdAt, 'yyyy/MM/dd HH:mm')}">—</td>
                <td class="actions" style="white-space:nowrap">
                    <!-- ویرایش → مستقیم به گام Packages -->
                    <a th:href="@{'/wizard/' + ${p.id} + '/packages'}" class="btn btn-secondary">ادامه/ویرایش</a>

                    <form th:action="@{'/projects/' + ${p.id} + '/delete'}" method="post" style="display:inline"
                          th:attr="onsubmit=|return confirm('پروژه «${p.projectName}» حذف شود؟')|">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-danger">حذف</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${projects == null or #lists.isEmpty(projects)}">
                <td colspan="5" class="muted">هنوز پروژه‌ای ثبت نشده است.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- ایجاد پروژه جدید (پایین) -->
    <div class="card">
        <div class="card-head"><h3>پروژهٔ جدید</h3></div>

        <form th:action="@{/projects}" method="post" class="form">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="grid-3">
                <div>
                    <label>نام پروژه</label>
                    <input type="text" name="projectName" required placeholder="مثلاً حسابداری"/>
                </div>
                <div>
                    <label>نام شرکت</label>
                    <input type="text" name="companyName" required placeholder="مثلاً behsazan"/>
                </div>
                <div>
                    <label>نسخهٔ جاوا</label>
                    <select name="javaVersion">
                        <option th:each="v : ${javaVersions}" th:value="${v}" th:text="${v}"
                                th:selected="${v == '17'}">17</option>
                    </select>
                </div>
            </div>

            <div class="actions" style="justify-content:flex-end">
                <button type="submit" class="btn btn-primary">ثبت پروژه</button>
            </div>
        </form>
    </div>

</div>
</body>
</html>
