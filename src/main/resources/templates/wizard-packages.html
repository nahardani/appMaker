<!DOCTYPE html>
<html lang="fa" dir="rtl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>گام ۲ — انتخاب پکیج‌ها</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
<!-- هدر یکپارچه -->
<th:block th:replace="fragments/_header :: topbar(title='گام ۲ — انتخاب پکیج‌ها', project=${project})"></th:block>

<div class="container">

    <!-- مشخصات پروژه -->
    <div class="card">
        <div class="card-head">
            <h3>مشخصات پروژه</h3>
        </div>
        <div class="grid-3">
            <div>
                <label>نام پروژه</label>
                <div class="muted" th:text="${project.projectName}">—</div>
            </div>
            <div>
                <label>نام شرکت</label>
                <div class="muted" th:text="${project.companyName}">—</div>
            </div>
            <div>
                <label>نسخهٔ جاوا</label>
                <div class="muted" th:text="${project.javaVersion != null ? project.javaVersion : '—'}">—</div>
            </div>
        </div>
    </div>

    <!-- فرم انتخاب پکیج‌ها -->
    <form th:action="@{'/wizard/' + ${project.id} + '/packages'}" method="post" class="card">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <!-- پیش‌فرض‌های قفل‌شده -->
        <div class="card">
            <div class="card-head"><h3>پکیج‌های فعالِ پیش‌فرض (غیرقابل تغییر)</h3></div>

            <!-- Hidden برای ارسال در POST -->
            <div th:each="o : ${lockedPkgs}">
                <input type="hidden" name="packages" th:value="${o.key}"/>
            </div>

            <div class="grid-3" style="margin-top:8px">
                <span class="chip-check" th:each="o : ${lockedPkgs}">
                    <b th:text="${o.label}">swagger</b><br>
                    <small th:text="${o.desc}">توضیح</small>
                </span>
            </div>
        </div>

        <!-- ویژگی‌های قابل انتخاب -->
        <div class="card">
            <div class="card-head"><h3>پکیج‌های قابل انتخاب</h3></div>
            <p class="muted">موارد زیر را بر اساس نیاز پروژه اضافه/حذف کنید.</p>

            <div class="grid-3" style="margin-top:8px">
                <label class="chip-check" th:each="o : ${optPkgs}">
                    <input type="checkbox"
                           name="packages"
                           th:value="${o.key}"
                           th:checked="${selected != null and selected.contains(o.key)}"/>
                    <span>
                        <b th:text="${o.label}">repository</b>
                        <small class="muted" th:text="${o.desc}">توضیح</small>
                    </span>
                </label>
            </div>
        </div>

<!--        &lt;!&ndash; اکشن‌های پایین صفحه: «ادامه به تنظیمات» در چپ &ndash;&gt;-->
<!--        <div class="actions" style="justify-content:flex-start; margin-top:12px">-->
<!--            &lt;!&ndash; با submit ذخیره می‌شود؛ کنترلر شما بعد از POST به /wizard/{id}/settings ریدایرکت می‌کند &ndash;&gt;-->
<!--            <button class="btn btn-primary" type="submit">ذخیره و ادامه → گام تنظیمات</button>-->
<!--            <div class="spacer"></div>-->
<!--            <a th:href="@{/projects}" class="btn btn-secondary">بازگشت</a>-->
<!--        </div>-->

        <div class="actions" style="justify-content:flex-start; margin-top:12px">
            <a th:href="@{/projects}" class="btn btn-secondary">بازگشت</a>
            <button class="btn btn-primary" type="submit">ذخیره و ادامه → کنترلرها</button>
        </div>

    </form>
</div>

<style>
    /* استایل‌های چیپ/چک‌باکس */
    .chip-check{
        display:flex; align-items:flex-start; gap:10px;
        border:1px solid var(--border, #2b3341);
        background: var(--card, #16202d);
        border-radius:12px; padding:10px 12px; cursor:default;
    }
    .chip-check input{ margin-top:4px; cursor:pointer; }
    .chip-check b{ display:block; }
    .chip-check small{ display:block; font-size:12px; }
    .grid-3{ display:grid; grid-template-columns: repeat(3, minmax(220px,1fr)); gap:12px; }
    @media (max-width: 900px){ .grid-3{ grid-template-columns: 1fr; } }
    .actions .spacer{ flex:1; }
</style>
</body>
</html>
